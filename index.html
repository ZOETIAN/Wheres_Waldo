<!DOCTYPE html>
<html>

<head>
<title>Where's Waldo</title>
<meta charset="UTF-8"></meta>
<script>
(function()
{
	var global = {};
	class Level
	{
		constructor(url,waldoX,waldoY,waldoR){
			this.image = document.getElementById(url);
			this.x = 0;
			this.y = 0;
			this.width = this.image.width;
			this.height = this.image.height;
			this.aura = 0;
			this.waldoRPx = waldoR;
			this.waldoXPx = waldoX;
			this.waldoYPx = waldoY;
		}
	}
	function scale()
	{
		if(global.level.image.width / self.innerWidth < global.level.image.height / self.innerHeight)
		{
			global.level.height = self.innerHeight;
			global.level.width = global.level.image.width / global.level.image.height * global.level.height;
			global.level.x = (self.innerWidth - global.level.width) / 2;
			global.level.y = 0;
		}
		else
		{
			global.level.width = self.innerWidth;
			global.level.height = global.level.image.height / global.level.image.width * global.level.width;
			global.level.x = 0;
			global.level.y = (self.innerHeight - global.level.height) / 2;
		}
		global.level.aura = global.level.width * global.level.height / 20000;

		global.level.waldoX = global.level.x + global.level.waldoXPx / global.level.image.width * global.level.width;
		global.level.waldoY = global.level.y + global.level.waldoYPx / global.level.image.height * global.level.height;
		global.level.waldoR = global.level.waldoRPx / global.level.image.width * self.innerWidth;

		global.main.width = self.innerWidth;
		global.main.height = self.innerHeight;
		global.drawable.fillStyle = "#000";
		global.drawable.fillRect(0,0,self.innerWidth,self.innerHeight);

		global.rgradient.width = global.level.aura * 2 + 2;
		global.rgradient.height = global.rgradient.width;
		var c = global.rgradient.getContext("2d");
		c.fillStyle = c.createRadialGradient(global.level.aura,global.level.aura,global.level.aura,global.level.aura,global.level.aura,global.level.aura / 2);
		c.fillStyle.addColorStop(1,'rgba(0,0,0,0)');
		c.fillStyle.addColorStop(0,'rgba(0,0,0,1)');
		c.fillRect(0,0,global.rgradient.width,global.rgradient.height);

		redraw({"clientX":global.mouseX,"clientY":global.mouseY});

		global.screen_width = self.innerWidth;
		global.screen_height = self.innerHeight;
	}
	function redraw(e)
	{
		global.drawable.fillStyle = "#000";
		global.drawable.fillRect(0,0,self.innerWidth,self.innerHeight);
		global.drawable.save();
		global.drawable.beginPath();
		global.drawable.moveTo(e.clientX-global.level.aura,e.clientY);
		global.drawable.lineWidth = 1;
		global.drawable.arcTo(e.clientX,e.clientY + Math.PI * 21 * global.level.aura,e.clientX+global.level.aura,e.clientY,global.level.aura);
		global.drawable.arcTo(e.clientX,e.clientY - Math.PI * 21 * global.level.aura,e.clientX-global.level.aura,e.clientY,global.level.aura);
		global.drawable.closePath();
		global.drawable.clip();
		global.drawable.drawImage(global.level.image,global.level.x,global.level.y,global.level.width,global.level.height);
		global.drawable.restore();
		global.drawable.drawImage(global.rgradient,e.clientX - global.level.aura - 1,e.clientY - global.level.aura);
		global.mouseX = e.clientX;
		global.mouseY = e.clientY;
	}
	window.addEventListener("load",
	function () {
		global.levels = 
		[
			new Level("l0",1738,431,24),
			new Level("l1",1148,1152,24),
			new Level("l2",1015,1153,25),
			new Level("l3",314,1707,20)
		];
		global.levelI = 0;
		global.level = global.levels[global.levelI];
		global.rgradient = document.createElement("canvas");
		global.main = document.getElementById("main");
		global.main.height = self.innerHeight;
		global.main.width = self.innerWidth;
		global.drawable = main.getContext("2d");
		scale();
		global.drawable.fillStyle = "#000";
		window.addEventListener("resize",scale);
		window.addEventListener("mousemove",redraw);
		global.screen_width = self.innerWidth;
		global.screen_height = self.innerHeight;
	});
	window.addEventListener("contextmenu",function(e){e.preventDefault()});
	window.addEventListener("dblclick",function(e)
	{
		var diffX = e.clientX - global.level.waldoX;
		var diffY = e.clientY - global.level.waldoY;
		if(Math.sqrt(diffX * diffX + diffY * diffY) <= global.level.waldoR)
		{
			global.drawable.fillStyle = "#FFEC8B";
			global.drawable.fillRect(0,0,self.innerWidth,self.innerHeight);
			alert("You find the Waldo! You can now continue the level " + ((global.levelI+=1)+1));
			global.level = global.levels[global.levelI];
			scale();
			global.drawable.fillStyle = "#000";
			global.drawable.fillRect(0,0,self.innerWidth,self.innerHeight);
		}
		else
		{
			global.drawable.fillStyle = "#B0E2FF";
			global.drawable.fillRect(0,0,self.innerWidth,self.innerHeight);
			alert("Really?! That's your Waldo!");
			global.drawable.fillStyle = "#000";
			global.drawable.fillRect(0,0,self.innerWidth,self.innerHeight);
		}
	});
})();
</script>
</head>
<body style="top:0;left:0;height:100%;width:100%;">
<canvas id="main" style="top:0;left:0;position: fixed;cursor:crosshair;"></canvas>
<img id="l0" src="http://jokideo.com/wp-content/uploads/2013/05/Lets-play-a-game-Wheres-wally-waldo.jpg" style="display: none"></img>
<img id="l1" src="http://www.whereswaldo.com/m/images/maps_future.jpg" style="display: none"></img>
<img id="l2" src="http://i.imgur.com/auEx3XS.jpg" style="display: none"></img>
<img id="l3" src="http://img01.thedrum.com/s3fs-public/drum_basic_article/97639/main_images/WheresWallyAtWembley_6.jpg" style="display: none"></img>
</body>

</html>	


<!--
 div is the circle around the cursor
 html is the overall web page
 body is the layer above the original waldo picture
 -->
